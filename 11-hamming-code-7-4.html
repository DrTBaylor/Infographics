<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(7,4) Hamming Code</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .viewport-container {
            width: 100%;
            max-width: 100vw;
            aspect-ratio: 16 / 9;
            max-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .design-surface {
            width: 1920px;
            height: 1080px;
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: top left;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #e0e0e0;
            padding: 40px 60px;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: #4fc3f7;
            font-size: 44px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .subtitle {
            text-align: center;
            color: #90a4ae;
            font-size: 20px;
            margin-bottom: 24px;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 0;
        }

        /* Info banner */
        .info-banner {
            background: rgba(79, 195, 247, 0.1);
            border: 2px solid #4fc3f7;
            border-radius: 14px;
            padding: 18px 30px;
            text-align: center;
        }

        .info-banner p {
            font-size: 18px;
            color: #e0e0e0;
            line-height: 1.5;
        }

        .info-banner span {
            color: #4fc3f7;
            font-weight: 600;
        }

        /* Main layout: two panels */
        .two-panels {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 30px;
            flex: 1;
            min-height: 0;
        }

        .panel {
            background: #0d1b2a;
            border: 3px solid #546e7a;
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            font-size: 22px;
            font-weight: 700;
            color: #e0e0e0;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .panel-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        /* Circuit diagram */
        .circuit-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .circuit-svg {
            width: 100%;
            height: 100%;
            max-height: 580px;
        }

        /* Interactive encoder */
        .encoder-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            justify-content: center;
        }

        .input-label {
            font-size: 16px;
            color: #90a4ae;
            text-align: center;
        }

        .data-input-row {
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .data-bit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .data-bit-input {
            width: 64px;
            height: 64px;
            background: #1a2a3a;
            border: 3px solid #26a69a;
            border-radius: 12px;
            font-size: 32px;
            font-family: 'Consolas', monospace;
            color: #80cbc4;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            outline: none;
        }

        .data-bit-input:hover {
            background: #26a69a;
            color: #fff;
        }

        .data-bit-label {
            font-size: 14px;
            color: #80cbc4;
            margin-top: 6px;
            font-weight: 600;
        }

        .arrow-down {
            text-align: center;
            color: #4fc3f7;
            font-size: 28px;
            margin: 10px 0;
        }

        .output-label {
            font-size: 16px;
            color: #90a4ae;
            text-align: center;
        }

        .codeword-display {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .codeword-bit {
            width: 54px;
            height: 68px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Consolas', monospace;
            cursor: pointer;
            transition: all 0.15s;
        }

        .codeword-bit.parity-p1 {
            background: rgba(126, 87, 194, 0.3);
            border: 3px solid #7e57c2;
        }

        .codeword-bit.parity-p2 {
            background: rgba(33, 150, 243, 0.3);
            border: 3px solid #2196f3;
        }

        .codeword-bit.parity-p3 {
            background: rgba(255, 183, 77, 0.3);
            border: 3px solid #ffb74d;
        }

        .codeword-bit.data {
            background: rgba(38, 166, 154, 0.3);
            border: 3px solid #26a69a;
        }

        .codeword-bit.error {
            background: rgba(239, 83, 80, 0.4) !important;
            border-color: #ef5350 !important;
            animation: pulse-error 0.5s ease-in-out infinite alternate;
        }

        @keyframes pulse-error {
            from { box-shadow: 0 0 8px rgba(239, 83, 80, 0.5); }
            to { box-shadow: 0 0 20px rgba(239, 83, 80, 0.9); }
        }

        .codeword-bit .pos-label {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
        }

        .codeword-bit .bit-val {
            font-size: 26px;
            font-weight: bold;
            color: #fff;
        }

        .codeword-bit:hover {
            transform: scale(1.08);
        }

        /* Error detection */
        .error-section {
            margin-top: 16px;
            padding: 18px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 12px;
            border: 2px solid #37474f;
        }

        .error-title {
            font-size: 16px;
            color: #4fc3f7;
            margin-bottom: 12px;
            font-weight: 600;
            text-align: center;
        }

        .syndrome-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .syndrome-bits {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .syndrome-label {
            color: #90a4ae;
            font-size: 14px;
        }

        .syndrome-bit {
            width: 36px;
            height: 36px;
            background: #1a2a3a;
            border: 2px solid #546e7a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Consolas', monospace;
            font-size: 20px;
            font-weight: bold;
            color: #4fc3f7;
        }

        .syndrome-result {
            font-size: 16px;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
        }

        .syndrome-result.no-error {
            color: #81c784;
            background: rgba(129, 199, 132, 0.15);
        }

        .syndrome-result.has-error {
            color: #ef5350;
            background: rgba(239, 83, 80, 0.15);
        }

        .button-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
        }

        .btn {
            background: linear-gradient(145deg, #2196f3, #1976d2);
            color: #fff;
            border: 2px solid #64b5f6;
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn.secondary {
            background: #0d1b2a;
            border-color: #546e7a;
            color: #90a4ae;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #90a4ae;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-color.p1 {
            background: #7e57c2;
        }

        .legend-color.p2 {
            background: #2196f3;
        }

        .legend-color.p3 {
            background: #ffb74d;
        }

        .legend-color.data {
            background: #26a69a;
        }

        .footer {
            text-align: center;
            color: #607d8b;
            font-size: 15px;
            padding-top: 16px;
            border-top: 2px solid rgba(255,255,255,0.1);
            margin-top: auto;
        }

        .footer span {
            color: #4fc3f7;
        }

        .debug-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #4fc3f7;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            z-index: 1000;
            display: none;
        }
    </style>
</head>

<body>
    <div class="viewport-container" id="viewportContainer">
        <div class="design-surface" id="designSurface">

            <h1>(7,4) Hamming Code Encoder</h1>
            <p class="subtitle">An error-correcting code that can detect and fix single-bit errors</p>

            <div class="content">
                <!-- Simple info banner -->
                <div class="info-banner">
                    <p>
                        This circuit takes <span>4 data bits</span> and adds <span>3 parity bits</span> to create a 7-bit codeword.
                        The parity bits are calculated using XOR gates so that <span>any single-bit error can be identified and corrected</span>.
                    </p>
                </div>

                <!-- Two panel layout -->
                <div class="two-panels">
                    <!-- Left: Circuit diagram -->
                    <div class="panel">
                        <div class="panel-header">Encoding Circuit</div>
                        <div class="panel-content">
                            <div class="circuit-container">
                                <svg class="circuit-svg" viewBox="0 0 750 520">
                                    <!-- Background grid lines for clarity -->
                                    <defs>
                                        <marker id="dot" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6">
                                            <circle cx="5" cy="5" r="4" fill="#26a69a"/>
                                        </marker>
                                    </defs>

                                    <!-- Data input labels and values -->
                                    <text x="20" y="65" fill="#80cbc4" font-size="22" font-weight="bold">d1</text>
                                    <text x="20" y="165" fill="#80cbc4" font-size="22" font-weight="bold">d2</text>
                                    <text x="20" y="265" fill="#80cbc4" font-size="22" font-weight="bold">d3</text>
                                    <text x="20" y="365" fill="#80cbc4" font-size="22" font-weight="bold">d4</text>

                                    <!-- Data bit value circles -->
                                    <circle cx="75" cy="60" r="18" fill="#1a2a3a" stroke="#26a69a" stroke-width="3"/>
                                    <text x="75" y="67" fill="#80cbc4" font-size="20" font-weight="bold" text-anchor="middle" id="circ-d1">0</text>

                                    <circle cx="75" cy="160" r="18" fill="#1a2a3a" stroke="#26a69a" stroke-width="3"/>
                                    <text x="75" y="167" fill="#80cbc4" font-size="20" font-weight="bold" text-anchor="middle" id="circ-d2">0</text>

                                    <circle cx="75" cy="260" r="18" fill="#1a2a3a" stroke="#26a69a" stroke-width="3"/>
                                    <text x="75" y="267" fill="#80cbc4" font-size="20" font-weight="bold" text-anchor="middle" id="circ-d3">0</text>

                                    <circle cx="75" cy="360" r="18" fill="#1a2a3a" stroke="#26a69a" stroke-width="3"/>
                                    <text x="75" y="367" fill="#80cbc4" font-size="20" font-weight="bold" text-anchor="middle" id="circ-d4">0</text>

                                    <!-- Main horizontal data lines -->
                                    <line x1="93" y1="60" x2="600" y2="60" stroke="#26a69a" stroke-width="3"/>
                                    <line x1="93" y1="160" x2="600" y2="160" stroke="#26a69a" stroke-width="3"/>
                                    <line x1="93" y1="260" x2="600" y2="260" stroke="#26a69a" stroke-width="3"/>
                                    <line x1="93" y1="360" x2="600" y2="360" stroke="#26a69a" stroke-width="3"/>

                                    <!-- Output labels -->
                                    <text x="620" y="65" fill="#80cbc4" font-size="16">pos 3</text>
                                    <text x="620" y="165" fill="#80cbc4" font-size="16">pos 5</text>
                                    <text x="620" y="265" fill="#80cbc4" font-size="16">pos 6</text>
                                    <text x="620" y="365" fill="#80cbc4" font-size="16">pos 7</text>

                                    <!-- ==================== XOR GATE p1 ==================== -->
                                    <!-- p1 = d1 XOR d2 XOR d4 -->
                                    <rect x="140" y="420" width="80" height="50" rx="8" fill="rgba(126,87,194,0.3)" stroke="#7e57c2" stroke-width="3"/>
                                    <text x="180" y="452" fill="#fff" font-size="18" font-weight="bold" text-anchor="middle">XOR</text>

                                    <!-- Vertical drops from data lines to p1 -->
                                    <circle cx="120" cy="60" r="6" fill="#26a69a"/>
                                    <line x1="120" y1="60" x2="120" y2="430" stroke="#7e57c2" stroke-width="2"/>
                                    <line x1="120" y1="430" x2="140" y2="430" stroke="#7e57c2" stroke-width="2"/>

                                    <circle cx="130" cy="160" r="6" fill="#26a69a"/>
                                    <line x1="130" y1="160" x2="130" y2="445" stroke="#7e57c2" stroke-width="2"/>
                                    <line x1="130" y1="445" x2="140" y2="445" stroke="#7e57c2" stroke-width="2"/>

                                    <circle cx="140" cy="360" r="6" fill="#26a69a"/>
                                    <line x1="140" y1="360" x2="140" y2="400" stroke="#7e57c2" stroke-width="2"/>
                                    <line x1="140" y1="400" x2="130" y2="400" stroke="#7e57c2" stroke-width="2"/>
                                    <line x1="130" y1="400" x2="130" y2="460" stroke="#7e57c2" stroke-width="2"/>
                                    <line x1="130" y1="460" x2="140" y2="460" stroke="#7e57c2" stroke-width="2"/>

                                    <!-- p1 output -->
                                    <line x1="220" y1="445" x2="260" y2="445" stroke="#7e57c2" stroke-width="3"/>
                                    <circle cx="280" cy="445" r="18" fill="#1a2a3a" stroke="#7e57c2" stroke-width="3"/>
                                    <text x="280" y="452" fill="#b39ddb" font-size="18" font-weight="bold" text-anchor="middle" id="circ-p1">0</text>
                                    <text x="315" y="452" fill="#b39ddb" font-size="18" font-weight="bold">p1</text>

                                    <!-- ==================== XOR GATE p2 ==================== -->
                                    <!-- p2 = d1 XOR d3 XOR d4 -->
                                    <rect x="360" y="420" width="80" height="50" rx="8" fill="rgba(33,150,243,0.3)" stroke="#2196f3" stroke-width="3"/>
                                    <text x="400" y="452" fill="#fff" font-size="18" font-weight="bold" text-anchor="middle">XOR</text>

                                    <!-- Vertical drops from data lines to p2 -->
                                    <circle cx="340" cy="60" r="6" fill="#26a69a"/>
                                    <line x1="340" y1="60" x2="340" y2="430" stroke="#2196f3" stroke-width="2"/>
                                    <line x1="340" y1="430" x2="360" y2="430" stroke="#2196f3" stroke-width="2"/>

                                    <circle cx="350" cy="260" r="6" fill="#26a69a"/>
                                    <line x1="350" y1="260" x2="350" y2="445" stroke="#2196f3" stroke-width="2"/>
                                    <line x1="350" y1="445" x2="360" y2="445" stroke="#2196f3" stroke-width="2"/>

                                    <circle cx="360" cy="360" r="6" fill="#26a69a"/>
                                    <line x1="360" y1="360" x2="360" y2="400" stroke="#2196f3" stroke-width="2"/>
                                    <line x1="360" y1="400" x2="350" y2="400" stroke="#2196f3" stroke-width="2"/>
                                    <line x1="350" y1="400" x2="350" y2="460" stroke="#2196f3" stroke-width="2"/>
                                    <line x1="350" y1="460" x2="360" y2="460" stroke="#2196f3" stroke-width="2"/>

                                    <!-- p2 output -->
                                    <line x1="440" y1="445" x2="480" y2="445" stroke="#2196f3" stroke-width="3"/>
                                    <circle cx="500" cy="445" r="18" fill="#1a2a3a" stroke="#2196f3" stroke-width="3"/>
                                    <text x="500" y="452" fill="#64b5f6" font-size="18" font-weight="bold" text-anchor="middle" id="circ-p2">0</text>
                                    <text x="535" y="452" fill="#64b5f6" font-size="18" font-weight="bold">p2</text>

                                    <!-- ==================== XOR GATE p3 ==================== -->
                                    <!-- p3 = d2 XOR d3 XOR d4 -->
                                    <rect x="550" y="280" width="80" height="50" rx="8" fill="rgba(255,183,77,0.3)" stroke="#ffb74d" stroke-width="3"/>
                                    <text x="590" y="312" fill="#fff" font-size="18" font-weight="bold" text-anchor="middle">XOR</text>

                                    <!-- Vertical drops from data lines to p3 -->
                                    <circle cx="500" cy="160" r="6" fill="#26a69a"/>
                                    <line x1="500" y1="160" x2="500" y2="290" stroke="#ffb74d" stroke-width="2"/>
                                    <line x1="500" y1="290" x2="550" y2="290" stroke="#ffb74d" stroke-width="2"/>

                                    <circle cx="520" cy="260" r="6" fill="#26a69a"/>
                                    <line x1="520" y1="260" x2="520" y2="305" stroke="#ffb74d" stroke-width="2"/>
                                    <line x1="520" y1="305" x2="550" y2="305" stroke="#ffb74d" stroke-width="2"/>

                                    <circle cx="540" cy="360" r="6" fill="#26a69a"/>
                                    <line x1="540" y1="360" x2="540" y2="320" stroke="#ffb74d" stroke-width="2"/>
                                    <line x1="540" y1="320" x2="550" y2="320" stroke="#ffb74d" stroke-width="2"/>

                                    <!-- p3 output -->
                                    <line x1="630" y1="305" x2="680" y2="305" stroke="#ffb74d" stroke-width="3"/>
                                    <circle cx="700" cy="305" r="18" fill="#1a2a3a" stroke="#ffb74d" stroke-width="3"/>
                                    <text x="700" y="312" fill="#ffb74d" font-size="18" font-weight="bold" text-anchor="middle" id="circ-p3">0</text>
                                    <text x="700" y="345" fill="#ffb74d" font-size="16" font-weight="bold" text-anchor="middle">p3</text>

                                    <!-- Equations at bottom -->
                                    <text x="180" y="505" fill="#b39ddb" font-size="15" text-anchor="middle">p1 = d1 + d2 + d4</text>
                                    <text x="400" y="505" fill="#64b5f6" font-size="15" text-anchor="middle">p2 = d1 + d3 + d4</text>
                                    <text x="630" y="390" fill="#ffb74d" font-size="15" text-anchor="middle">p3 = d2 + d3 + d4</text>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Interactive encoder -->
                    <div class="panel">
                        <div class="panel-header">Try It: Interactive Encoder</div>
                        <div class="panel-content">
                            <div class="encoder-section">
                                <div class="input-label">Click data bits to toggle (0/1):</div>
                                <div class="data-input-row">
                                    <div class="data-bit-group">
                                        <button class="data-bit-input" id="d1" data-bit="0">0</button>
                                        <div class="data-bit-label">d1</div>
                                    </div>
                                    <div class="data-bit-group">
                                        <button class="data-bit-input" id="d2" data-bit="0">0</button>
                                        <div class="data-bit-label">d2</div>
                                    </div>
                                    <div class="data-bit-group">
                                        <button class="data-bit-input" id="d3" data-bit="0">0</button>
                                        <div class="data-bit-label">d3</div>
                                    </div>
                                    <div class="data-bit-group">
                                        <button class="data-bit-input" id="d4" data-bit="0">0</button>
                                        <div class="data-bit-label">d4</div>
                                    </div>
                                </div>

                                <div class="arrow-down">&#8595; Encoded Codeword &#8595;</div>

                                <div class="output-label">7-bit output (click any bit to simulate an error):</div>
                                <div class="codeword-display" id="codewordDisplay">
                                    <!-- Generated by JS -->
                                </div>

                                <div class="legend">
                                    <div class="legend-item">
                                        <div class="legend-color p1"></div>
                                        <span>p1</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color p2"></div>
                                        <span>p2</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color p3"></div>
                                        <span>p3</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color data"></div>
                                        <span>Data</span>
                                    </div>
                                </div>

                                <div class="error-section">
                                    <div class="error-title">Error Detection (Syndrome)</div>
                                    <div class="syndrome-display">
                                        <div class="syndrome-bits">
                                            <span class="syndrome-label">Syndrome:</span>
                                            <div class="syndrome-bit" id="s3">0</div>
                                            <div class="syndrome-bit" id="s2">0</div>
                                            <div class="syndrome-bit" id="s1">0</div>
                                            <span class="syndrome-label">= position <span id="syndromeDecimal">0</span></span>
                                        </div>
                                        <div class="syndrome-result no-error" id="syndromeResult">
                                            No error
                                        </div>
                                    </div>
                                </div>

                                <div class="button-row">
                                    <button class="btn" id="randomBtn">Random Data</button>
                                    <button class="btn secondary" id="resetBtn">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer">
                Invented by <span>Richard Hamming</span> at Bell Labs (1950) | Used in memory (ECC RAM) and data transmission
            </div>
        </div>
    </div>

    <div class="debug-info" id="debugInfo"></div>

    <script>
        // ============================================
        // AUTO-RESIZE SYSTEM
        // ============================================

        const DESIGN_WIDTH = 1920;
        const DESIGN_HEIGHT = 1080;

        function autoResize() {
            const container = document.getElementById('viewportContainer');
            const surface = document.getElementById('designSurface');

            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            let containerWidth, containerHeight;

            if (viewportWidth / viewportHeight > 16 / 9) {
                containerHeight = viewportHeight;
                containerWidth = containerHeight * (16 / 9);
            } else {
                containerWidth = viewportWidth;
                containerHeight = containerWidth * (9 / 16);
            }

            container.style.width = containerWidth + 'px';
            container.style.height = containerHeight + 'px';

            const scale = containerWidth / DESIGN_WIDTH;
            surface.style.transform = `scale(${scale})`;
        }

        function initializeResponsive() {
            autoResize();
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(autoResize, 50);
            });
        }

        // ============================================
        // HAMMING CODE LOGIC
        // ============================================

        let dataBits = [0, 0, 0, 0];
        let codeword = [0, 0, 0, 0, 0, 0, 0];
        let receivedWord = [0, 0, 0, 0, 0, 0, 0];

        function encode() {
            // Place data bits: d1->pos3, d2->pos5, d3->pos6, d4->pos7
            codeword[2] = dataBits[0];
            codeword[4] = dataBits[1];
            codeword[5] = dataBits[2];
            codeword[6] = dataBits[3];

            // Calculate parity bits
            codeword[0] = dataBits[0] ^ dataBits[1] ^ dataBits[3]; // p1 = d1 XOR d2 XOR d4
            codeword[1] = dataBits[0] ^ dataBits[2] ^ dataBits[3]; // p2 = d1 XOR d3 XOR d4
            codeword[3] = dataBits[1] ^ dataBits[2] ^ dataBits[3]; // p3 = d2 XOR d3 XOR d4

            receivedWord = [...codeword];
        }

        function calculateSyndrome() {
            const s1 = receivedWord[0] ^ receivedWord[2] ^ receivedWord[4] ^ receivedWord[6];
            const s2 = receivedWord[1] ^ receivedWord[2] ^ receivedWord[5] ^ receivedWord[6];
            const s3 = receivedWord[3] ^ receivedWord[4] ^ receivedWord[5] ^ receivedWord[6];
            return { s1, s2, s3, decimal: s3 * 4 + s2 * 2 + s1 };
        }

        // ============================================
        // UI RENDERING
        // ============================================

        function updateCircuitDiagram() {
            document.getElementById('circ-d1').textContent = dataBits[0];
            document.getElementById('circ-d2').textContent = dataBits[1];
            document.getElementById('circ-d3').textContent = dataBits[2];
            document.getElementById('circ-d4').textContent = dataBits[3];
            document.getElementById('circ-p1').textContent = codeword[0];
            document.getElementById('circ-p2').textContent = codeword[1];
            document.getElementById('circ-p3').textContent = codeword[3];
        }

        function renderCodeword() {
            const container = document.getElementById('codewordDisplay');
            const labels = ['p1', 'p2', 'd1', 'p3', 'd2', 'd3', 'd4'];
            const types = ['parity-p1', 'parity-p2', 'data', 'parity-p3', 'data', 'data', 'data'];

            const syndrome = calculateSyndrome();
            const errorPos = syndrome.decimal;

            container.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const bit = document.createElement('div');
                const hasError = (errorPos === i + 1);
                bit.className = `codeword-bit ${types[i]} ${hasError ? 'error' : ''}`;
                bit.innerHTML = `
                    <div class="pos-label">${labels[i]}</div>
                    <div class="bit-val">${receivedWord[i]}</div>
                `;
                bit.addEventListener('click', () => flipBit(i));
                container.appendChild(bit);
            }
        }

        function renderSyndrome() {
            const syndrome = calculateSyndrome();

            document.getElementById('s1').textContent = syndrome.s1;
            document.getElementById('s2').textContent = syndrome.s2;
            document.getElementById('s3').textContent = syndrome.s3;
            document.getElementById('syndromeDecimal').textContent = syndrome.decimal;

            const resultEl = document.getElementById('syndromeResult');
            if (syndrome.decimal === 0) {
                resultEl.textContent = 'No error';
                resultEl.className = 'syndrome-result no-error';
            } else {
                resultEl.textContent = `Error at position ${syndrome.decimal}!`;
                resultEl.className = 'syndrome-result has-error';
            }
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        function toggleDataBit(index) {
            dataBits[index] = dataBits[index] === 0 ? 1 : 0;
            const btn = document.getElementById(`d${index + 1}`);
            btn.textContent = dataBits[index];
            encode();
            updateCircuitDiagram();
            renderCodeword();
            renderSyndrome();
        }

        function flipBit(position) {
            receivedWord[position] = receivedWord[position] === 0 ? 1 : 0;
            renderCodeword();
            renderSyndrome();
        }

        function randomData() {
            for (let i = 0; i < 4; i++) {
                dataBits[i] = Math.round(Math.random());
                document.getElementById(`d${i + 1}`).textContent = dataBits[i];
            }
            encode();
            updateCircuitDiagram();
            renderCodeword();
            renderSyndrome();
        }

        function reset() {
            dataBits = [0, 0, 0, 0];
            for (let i = 0; i < 4; i++) {
                document.getElementById(`d${i + 1}`).textContent = '0';
            }
            encode();
            updateCircuitDiagram();
            renderCodeword();
            renderSyndrome();
        }

        // ============================================
        // INITIALIZE
        // ============================================

        initializeResponsive();

        for (let i = 0; i < 4; i++) {
            document.getElementById(`d${i + 1}`).addEventListener('click', () => toggleDataBit(i));
        }

        document.getElementById('randomBtn').addEventListener('click', randomData);
        document.getElementById('resetBtn').addEventListener('click', reset);

        encode();
        updateCircuitDiagram();
        renderCodeword();
        renderSyndrome();
    </script>
</body>

</html>
